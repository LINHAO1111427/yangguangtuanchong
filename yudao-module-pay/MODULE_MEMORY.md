# å¾®æœåŠ¡ Memory - payï¼ˆæ”¯ä»˜æœåŠ¡æ¨¡å—ï¼‰

[â¬…ï¸ è¿”å›é¡¹ç›®æ€»è§ˆ](../../PROJECT_MEMORY.md)

**ä¾èµ–æ¨¡å—**ï¼š[member](../yudao-module-member/MODULE_MEMORY.md)ï¼ˆç”¨æˆ·ä¿¡æ¯ï¼‰ â€¢ [content](../yudao-module-content/MODULE_MEMORY.md)ï¼ˆå†…å®¹ä¿¡æ¯ï¼‰

---

## ğŸ”´ å¼ºåˆ¶è§„åˆ™
1. **æ‰€æœ‰äº¤æ˜“å¿…é¡»è®°å½•äº¤æ˜“æµæ°´**
2. **æ‰€æœ‰æ”¶æ”¯å¿…é¡»å¹³è¡¡ï¼ˆå®šæœŸå¯¹è´¦ï¼‰**
3. **æç°ç”³è¯·å¿…é¡»ç»è¿‡å®¡æ ¸**
4. **é’±åŒ…ä½™é¢ä¿®æ”¹å¿…é¡»ä½¿ç”¨ä¹è§‚é”é˜²æ­¢å¹¶å‘**
5. **æ•æ„Ÿæ“ä½œå¿…é¡»è®°å½•å®¡è®¡æ—¥å¿—**

### Implementation Gaps (2025-10-21)
- REST prefix alignment pending: app/admin controllers still expose `/pay/*`; add `/api/v1.0.1/pay/*` and `/admin/pay/*` gateways to match spec.
- Reward service hard-codes commission (see `PayRewardServiceImpl`); move to configurable rule + persistence beforeæ ‡è®°å®Œæˆ.
- æ‰“èµ/æç°ç­‰èµ„é‡‘æ“ä½œç¼ºå°‘é£æ§ã€é™æµä¸å¹‚ç­‰å®ç°ï¼Œéœ€è¡¥å……äº‹åŠ¡æ€§æ ¡éªŒä¸ Kafka/äº‹ä»¶æµ.
## ğŸ“‹ æ¨¡å—å¿«é€Ÿç†è§£
- **ä¸€å¥è¯æè¿°**ï¼šç®¡ç†ç”¨æˆ·é’±åŒ…ã€æ”¯ä»˜äº¤æ˜“ã€æç°ç”³è¯·ã€æ‰“èµå¥–åŠ±ç­‰æ”¯ä»˜ç›¸å…³åŠŸèƒ½
- **æ ¸å¿ƒèŒè´£**ï¼šé’±åŒ…ä½™é¢ç®¡ç† + äº¤æ˜“æµæ°´è®°å½• + æ‰“èµåŠŸèƒ½ + æç°ç®¡ç† + å……å€¼åŠŸèƒ½
- **æœåŠ¡ç«¯å£**ï¼š48084
- **æ•°æ®åº“**ï¼šproduct_dbï¼ˆå•†å“åº“ï¼Œæš‚ç”¨äºæ”¯ä»˜ï¼‰

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„
### ä¾èµ–å…³ç³»
```
pay â†’ memberï¼ˆç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ï¼‰ã€contentï¼ˆå†…å®¹ä¿¡æ¯æŸ¥è¯¢ï¼‰
pay æä¾›ç»™ â†’ contentï¼ˆæ‰“èµåŠŸèƒ½ï¼‰ã€memberï¼ˆä»»åŠ¡å¥–åŠ±å‘æ”¾ï¼‰
```

### é¡¹ç›®ç»“æ„
```
yudao-module-pay/
â”œâ”€â”€ yudao-module-pay-api/         # APIæ¥å£å®šä¹‰
â”‚   â””â”€â”€ cn.iocoder.yudao.module.pay.api/
â”‚       â”œâ”€â”€ wallet/               # é’±åŒ…API
â”‚       â”œâ”€â”€ reward/               # æ‰“èµAPI
â”‚       â”œâ”€â”€ withdraw/             # æç°API
â”‚       â””â”€â”€ transaction/          # äº¤æ˜“API
â”œâ”€â”€ yudao-module-pay-server/      # ä¸šåŠ¡å®ç°
â”‚   â””â”€â”€ cn.iocoder.yudao.module.pay/
â”‚       â”œâ”€â”€ controller/
â”‚       â”‚   â”œâ”€â”€ app/              # Cç«¯APPæ¥å£
â”‚       â”‚   â”‚   â”œâ”€â”€ wallet/       # é’±åŒ…æ¥å£
â”‚       â”‚   â”‚   â”œâ”€â”€ reward/       # æ‰“èµæ¥å£
â”‚       â”‚   â”‚   â”œâ”€â”€ withdraw/     # æç°æ¥å£
â”‚       â”‚   â”‚   â””â”€â”€ recharge/     # å……å€¼æ¥å£
â”‚       â”‚   â””â”€â”€ admin/            # ç®¡ç†åå°æ¥å£
â”‚       â”‚       â””â”€â”€ withdraw/     # æç°å®¡æ ¸æ¥å£
â”‚       â”œâ”€â”€ service/
â”‚       â”‚   â”œâ”€â”€ wallet/           # é’±åŒ…æœåŠ¡
â”‚       â”‚   â”‚   â””â”€â”€ WalletService.java         # é’±åŒ…æœåŠ¡
â”‚       â”‚   â”œâ”€â”€ reward/           # æ‰“èµæœåŠ¡
â”‚       â”‚   â”‚   â””â”€â”€ RewardService.java         # æ‰“èµæœåŠ¡
â”‚       â”‚   â”œâ”€â”€ withdraw/         # æç°æœåŠ¡
â”‚       â”‚   â”‚   â”œâ”€â”€ WithdrawService.java       # æç°æœåŠ¡
â”‚       â”‚   â”‚   â””â”€â”€ WithdrawAuditService.java  # æç°å®¡æ ¸æœåŠ¡
â”‚       â”‚   â”œâ”€â”€ recharge/         # å……å€¼æœåŠ¡
â”‚       â”‚   â”‚   â””â”€â”€ RechargeService.java       # å……å€¼æœåŠ¡
â”‚       â”‚   â”œâ”€â”€ transaction/      # äº¤æ˜“æœåŠ¡
â”‚       â”‚   â”‚   â””â”€â”€ TransactionService.java    # äº¤æ˜“æµæ°´æœåŠ¡
â”‚       â”‚   â””â”€â”€ reconciliation/   # å¯¹è´¦æœåŠ¡
â”‚       â”‚       â””â”€â”€ ReconciliationService.java # å¯¹è´¦æœåŠ¡
â”‚       â”œâ”€â”€ dal/
â”‚       â”‚   â”œâ”€â”€ dataobject/       # æ•°æ®å¯¹è±¡
â”‚       â”‚   â”‚   â”œâ”€â”€ WalletDO.java             # é’±åŒ…å®ä½“
â”‚       â”‚   â”‚   â”œâ”€â”€ RewardDO.java             # æ‰“èµå®ä½“
â”‚       â”‚   â”‚   â”œâ”€â”€ WithdrawDO.java           # æç°å®ä½“
â”‚       â”‚   â”‚   â”œâ”€â”€ TransactionDO.java        # äº¤æ˜“æµæ°´å®ä½“
â”‚       â”‚   â”‚   â””â”€â”€ RechargeDO.java           # å……å€¼å®ä½“
â”‚       â”‚   â””â”€â”€ mapper/           # Mapper
â”‚       â””â”€â”€ job/
â”‚           â”œâ”€â”€ WithdrawProcessJob.java       # æç°å¤„ç†å®šæ—¶ä»»åŠ¡
â”‚           â”œâ”€â”€ ReconciliationJob.java        # å¯¹è´¦å®šæ—¶ä»»åŠ¡
â”‚           â””â”€â”€ RewardExpireJob.java          # æ‰“èµè¿‡æœŸæ¸…ç†ä»»åŠ¡
```

## ğŸš€ å·²å®ç°åŠŸèƒ½

### âœ… é’±åŒ…ä½™é¢ç®¡ç†ï¼ˆ100%ï¼‰
- **WalletService.java**ï¼šé’±åŒ…æœåŠ¡
  - è·å–é’±åŒ…ä½™é¢
  - å¢åŠ ä½™é¢ï¼ˆä¹è§‚é”é˜²æ­¢å¹¶å‘ï¼‰
  - å‡å°‘ä½™é¢ï¼ˆä¹è§‚é”é˜²æ­¢å¹¶å‘ï¼‰
  - é’±åŒ…è½¬è´¦
  - ä½™é¢å†»ç»“/è§£å†»

- **é’±åŒ…æ¥å£**ï¼š`AppWalletController.java`
  ```
  GET  /api/v1.0.1/pay/wallet/balance               # è·å–é’±åŒ…ä½™é¢
  POST /api/v1.0.1/pay/wallet/transfer              # è½¬è´¦
  GET  /api/v1.0.1/pay/wallet/transaction-records   # è·å–äº¤æ˜“è®°å½•
  ```

### âœ… äº¤æ˜“æµæ°´ç®¡ç†ï¼ˆ100%ï¼‰
- **TransactionService.java**ï¼šäº¤æ˜“æµæ°´æœåŠ¡
  - è®°å½•äº¤æ˜“æµæ°´
  - äº¤æ˜“æµæ°´æŸ¥è¯¢
  - æ”¶æ”¯ç»Ÿè®¡

- **äº¤æ˜“æ¥å£**ï¼š`AppTransactionController.java`
  ```
  GET  /api/v1.0.1/pay/transaction/list             # äº¤æ˜“æµæ°´åˆ—è¡¨
  GET  /api/v1.0.1/pay/transaction/statistics       # æ”¶æ”¯ç»Ÿè®¡
  ```

### âš ï¸ å¾…å¼€å‘åŠŸèƒ½

#### æ‰“èµåŠŸèƒ½ï¼ˆ0%ï¼‰- P0ä¼˜å…ˆçº§ âš ï¸ åŒ…å«åˆ†æˆè§„åˆ™
**éœ€æ±‚**ï¼ˆæ¥è‡ªéœ€æ±‚åˆ†ææ–°ç‰ˆ.md 4.2ç« ï¼‰ï¼šç”¨æˆ·æ‰“èµä½œè€…è·å¾—æ”¶ç›Šï¼Œå¹³å°è¿›è¡Œåˆ†æˆ
- æ‰“èµé‡‘é¢é€‰æ‹©ï¼ˆ1å¸ã€5å¸ã€10å¸ã€50å¸ç­‰ï¼‰
- æ‰“èµè®°å½•
- æ‰“èµæ’è¡Œï¼ˆæ˜¾ç¤ºæ‰“èµæœ€å¤šçš„ç”¨æˆ·ï¼‰
- æ‰“èµé€šçŸ¥
- **å¹³å°åˆ†æˆæœºåˆ¶**ï¼šå¹³å°æŠ½å– 10.5% æˆ– 20.6%ï¼ˆç”±ä¿±ç”Ÿç®¡ç†å‘˜è®¾ç½®ï¼‰

**æµç¨‹**ï¼š
1. ç”¨æˆ·é€‰æ‹©æ‰“èµé‡‘é¢
2. ä»é’±åŒ…æ‰£æ¬¾ï¼ˆéªŒè¯ä½™é¢å……è¶³ï¼‰
3. æ ¹æ®åˆ†æˆé…ç½®è®¡ç®—åˆ†è´¦ï¼š
   ```
   æ‰“èµé‡‘é¢ = 100å¸
   åˆ†æˆæ¯”ä¾‹ = 10.5%ï¼ˆå¯é…ç½®ï¼‰
   å¹³å°æ”¶å…¥ = 100 Ã— 10.5% = 10.5å¸
   ä½œè€…å…¥è´¦ = 100 Ã— (1 - 10.5%) = 89.5å¸
   ```
4. ä½œè€…é’±åŒ…å…¥è´¦ï¼ˆ89.5å¸ï¼‰
5. å¹³å°é’±åŒ…å…¥è´¦ï¼ˆ10.5å¸ï¼‰
6. è®°å½•æ‰“èµæµæ°´å’Œåˆ†æˆè®°å½•
7. å‘é€æ‰“èµé€šçŸ¥ç»™ä½œè€…

**è¡¨è®¾è®¡**ï¼š
- `reward_record`ï¼ˆæ‰“èµè®°å½•è¡¨ï¼‰
  - reward_idã€payer_idã€payee_idã€post_idã€amountï¼ˆåŸå§‹é‡‘é¢ï¼‰, create_time
  - ç´¢å¼•ï¼šidx_payer_id, idx_payee_id, idx_post_id, idx_create_time

- `reward_settlement`ï¼ˆæ‰“èµåˆ†æˆè®°å½•è¡¨ï¼‰âœ… æ–°å¢
  - settlement_idã€reward_idã€original_amountã€platform_ratioï¼ˆåˆ†æˆæ¯”ä¾‹ï¼‰ã€platform_incomeã€author_income, settle_time
  - ç´¢å¼•ï¼šidx_reward_id, idx_payee_id, idx_settle_time

- `system_config`ï¼ˆç³»ç»Ÿé…ç½®è¡¨ï¼‰âœ… æ–°å¢ï¼ˆä»…ä¿±ç”Ÿç®¡ç†å‘˜å¯é…ç½®ï¼‰
  - config_idã€config_key(reward_platform_ratio)ã€config_value(10.5)ã€descriptionã€update_time

**å¼€å‘è®¡åˆ’**ï¼š3äººå¤©
- Day1: è®¾è®¡æ‰“èµè¡¨ç»“æ„å’Œåˆ†æˆæµç¨‹ã€åˆ†æˆé…ç½®ç®¡ç†æ¥å£
- Day2: å®ç°æ‰“èµé€»è¾‘ï¼ˆæ‰£æ¬¾/åˆ†æˆ/å…¥è´¦ï¼‰ã€åˆ†æˆè®¡ç®—
- Day3: å¼€å‘æ‰“èµç›¸å…³æ¥å£ã€åˆ†æˆç»Ÿè®¡æ¥å£

**å…³é”®ç‚¹**ï¼š
- åˆ†æˆæ¯”ä¾‹å¿…é¡»ç”±ä¿±ç”Ÿç®¡ç†å‘˜(0çº§)åœ¨Adminåå°é…ç½®
- åˆ†æˆç»“ç®—å¿…é¡»åœ¨PayServiceä¸­å®Œæˆï¼ˆé˜²æ­¢é’±è´¦ä¸ç¬¦ï¼‰
- éœ€è¦å®šæœŸå¯¹è´¦å’Œåˆ†æˆå¯¹è´¦æŠ¥è¡¨

#### å……å€¼åŠŸèƒ½ï¼ˆ0%ï¼‰- P1ä¼˜å…ˆçº§ âœ… å®Œå–„æ”¯ä»˜æ¸ é“
**éœ€æ±‚**ï¼ˆæ¥è‡ªéœ€æ±‚æ–‡æ¡£.md ç¬¬100-104è¡Œï¼‰ï¼šç”¨æˆ·å……å€¼é‡‘å¸
- æ”¯æŒå¤šç§æ”¯ä»˜æ¸ é“ï¼šå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ã€é“¶è¡Œå¡ã€æ•°å­—äººæ°‘å¸
- å……å€¼é‡‘é¢é€‰æ‹©ï¼ˆ6.99å…ƒ/100å¸ã€12.99å…ƒ/250å¸ç­‰ï¼‰
- å……å€¼è®°å½•æŸ¥è¯¢
- å……å€¼æˆåŠŸå›è°ƒ
- é€€æ¬¾æ”¯æŒï¼ˆé€€æ¬¾åˆ°åŸæ”¯ä»˜è´¦æˆ·ï¼‰
- åˆ°è´¦æé†’ï¼ˆçŸ­ä¿¡/æ¨é€æé†’å……å€¼æˆåŠŸï¼‰

**æ”¯ä»˜æ¸ é“é›†æˆ**ï¼š
```
1. å¾®ä¿¡æ”¯ä»˜ï¼ˆAppæ”¯ä»˜ï¼‰- é›†æˆå¾®ä¿¡SDK
2. æ”¯ä»˜å® - é›†æˆæ”¯ä»˜å®SDK
3. é“¶è¡Œå¡ - é€šè¿‡ç¬¬ä¸‰æ–¹æ”¯ä»˜ç½‘å…³ï¼ˆå¦‚æ˜“å®ã€èšåˆæ”¯ä»˜ï¼‰
4. æ•°å­—äººæ°‘å¸ - é›†æˆå¤®è¡Œæ•°å­—äººæ°‘å¸APIï¼ˆå¯é€‰ï¼‰
```

**è¡¨è®¾è®¡**ï¼š
- `recharge_order`ï¼ˆå……å€¼è®¢å•è¡¨ï¼‰âœ… è¡¥å……å­—æ®µ
  - order_idã€user_idã€amount, coins, payment_methodï¼ˆ1å¾®ä¿¡/2æ”¯ä»˜å®/3é“¶è¡Œå¡/4æ•°å­—äººæ°‘å¸ï¼‰
  - statusï¼ˆ0å¾…æ”¯ä»˜/1å·²æ”¯ä»˜/2å·²å–æ¶ˆ/3å·²é€€æ¬¾ï¼‰, create_time, pay_time
  - ç´¢å¼•ï¼šidx_user_id, idx_payment_method, idx_create_time

- `recharge_package`ï¼ˆå……å€¼å¥—é¤è¡¨ï¼‰
  - package_idã€price, coins, description, is_active
  - ç´¢å¼•ï¼šidx_is_active

- `recharge_refund`ï¼ˆé€€æ¬¾è®°å½•è¡¨ï¼‰âœ… æ–°å¢
  - refund_idã€order_id, refund_amount, refund_reason, refund_statusï¼ˆ0ç”³è¯·ä¸­/1å·²é€€æ¬¾ï¼‰
  - refund_time, arrival_timeï¼ˆåˆ°è´¦æ—¶é—´ï¼‰
  - ç´¢å¼•ï¼šidx_order_id, idx_refund_status

**å¼€å‘è®¡åˆ’**ï¼š3äººå¤©
- Day1: é›†æˆå¤šä¸ªæ”¯ä»˜SDKï¼Œè®¾è®¡æ”¯ä»˜æµç¨‹
- Day2: å®ç°å……å€¼è®¢å•ç®¡ç†å’Œå›è°ƒå¤„ç†
- Day3: å®ç°é€€æ¬¾æµç¨‹å’Œåˆ°è´¦æé†’

#### æç°åŠŸèƒ½ï¼ˆ0%ï¼‰- P0ä¼˜å…ˆçº§
**éœ€æ±‚**ï¼šç”¨æˆ·æç°ä½™é¢åˆ°é“¶è¡Œè´¦æˆ·
- æç°ç”³è¯·ï¼ˆè¾“å…¥é‡‘é¢ã€é“¶è¡Œè´¦æˆ·ï¼‰
- æç°å®¡æ ¸ï¼ˆç®¡ç†å‘˜å®¡æ ¸ï¼‰
- æç°å¤„ç†ï¼ˆè‡ªåŠ¨è½¬è´¦/æ‰‹åŠ¨è½¬è´¦ï¼‰
- æç°è®°å½•

**æµç¨‹**ï¼š
1. ç”¨æˆ·ç”³è¯·æç°
2. å†»ç»“é’±åŒ…é‡‘é¢
3. ç®¡ç†å‘˜å®¡æ ¸ï¼ˆæ‰¹å‡†/æ‹’ç»ï¼‰
4. æ‰¹å‡†åè§¦å‘æ”¯ä»˜æ¥å£è½¬è´¦
5. è½¬è´¦æˆåŠŸåæ›´æ–°æç°çŠ¶æ€

**è¡¨è®¾è®¡**ï¼š
- `withdraw_request`ï¼ˆæç°ç”³è¯·è¡¨ï¼‰
  - request_idã€user_idã€amount, statusï¼ˆ0å¾…å®¡æ ¸/1å·²æ‰¹å‡†/2å·²æ‹’ç»/3å·²å¤„ç†ï¼‰, bank_account, create_time
  - ç´¢å¼•ï¼šidx_user_id, idx_status, idx_create_time
- `withdraw_audit`ï¼ˆå®¡æ ¸è®°å½•è¡¨ï¼‰
  - audit_idã€request_id, auditor_id, audit_resultï¼ˆ0æ‰¹å‡†/1æ‹’ç»ï¼‰, reason, audit_time

**å¼€å‘è®¡åˆ’**ï¼š3äººå¤©
- Day1: è®¾è®¡æç°æµç¨‹å’Œè¡¨ç»“æ„
- Day2: å®ç°æç°ç”³è¯·å’Œå®¡æ ¸é€»è¾‘
- Day3: å®ç°æç°æ”¯ä»˜å’ŒçŠ¶æ€ç®¡ç†

#### æç°å®¡æ ¸ï¼ˆ0%ï¼‰- P0ä¼˜å…ˆçº§
**éœ€æ±‚**ï¼šç®¡ç†å‘˜å®¡æ ¸æç°ç”³è¯·
- å¾…å®¡æ ¸åˆ—è¡¨
- æ‰¹é‡å®¡æ ¸
- å•ä¸ªå®¡æ ¸
- æç°ç»Ÿè®¡

**ç®¡ç†æ¥å£**ï¼š`AdminWithdrawController.java`
  ```
  GET  /admin/pay/withdraw/list                     # æç°åˆ—è¡¨
  POST /admin/pay/withdraw/approve                  # æ‰¹å‡†æç°
  POST /admin/pay/withdraw/reject                   # æ‹’ç»æç°
  POST /admin/pay/withdraw/batch-approve            # æ‰¹é‡æ‰¹å‡†
  GET  /admin/pay/withdraw/statistics               # æç°ç»Ÿè®¡
  ```

**å¼€å‘è®¡åˆ’**ï¼š3äººå¤©ï¼ˆä¸æç°åŠŸèƒ½ä¸€èµ·å®Œæˆï¼‰

#### æŠ¼é‡‘ç®¡ç†ï¼ˆ0%ï¼‰- P1ä¼˜å…ˆçº§
**éœ€æ±‚**ï¼šå•†åŸå–å®¶çš„æŠ¼é‡‘ç®¡ç†
- æŠ¼é‡‘å……å€¼
- æŠ¼é‡‘æŸ¥è¯¢
- æŠ¼é‡‘æ‰£è´¹
- æŠ¼é‡‘æç°

**å¼€å‘è®¡åˆ’**ï¼š3äººå¤©

## ğŸ”§ æ ¸å¿ƒä»£ç ä½ç½®

### Controllerï¼ˆæ¥å£å±‚ï¼‰
- `AppWalletController.java` - é’±åŒ…æ¥å£ - `/api/v1.0.1/pay/wallet/*`
- `AppRewardController.java` - æ‰“èµæ¥å£ - `/api/v1.0.1/pay/reward/*`
- `AppWithdrawController.java` - æç°æ¥å£ - `/api/v1.0.1/pay/withdraw/*`
- `AppRechargeController.java` - å……å€¼æ¥å£ - `/api/v1.0.1/pay/recharge/*`
- `AdminWithdrawController.java` - æç°å®¡æ ¸æ¥å£ - `/admin/pay/withdraw/*`

### Serviceï¼ˆä¸šåŠ¡å±‚ï¼‰
- `WalletService.java` - é’±åŒ…æœåŠ¡ï¼ˆä¹è§‚é”å¹¶å‘æ§åˆ¶ï¼‰
- `RewardService.java` - æ‰“èµæœåŠ¡
- `WithdrawService.java` - æç°ç”³è¯·æœåŠ¡
- `WithdrawAuditService.java` - æç°å®¡æ ¸æœåŠ¡
- `RechargeService.java` - å……å€¼æœåŠ¡
- `TransactionService.java` - äº¤æ˜“æµæ°´æœåŠ¡
- `ReconciliationService.java` - å¯¹è´¦æœåŠ¡

### DataObjectï¼ˆæ•°æ®å¯¹è±¡ï¼‰
- `WalletDO.java` - é’±åŒ…å®ä½“ï¼ˆåŒ…å«versionå­—æ®µç”¨äºä¹è§‚é”ï¼‰
- `RewardDO.java` - æ‰“èµå®ä½“
- `WithdrawDO.java` - æç°å®ä½“
- `TransactionDO.java` - äº¤æ˜“æµæ°´å®ä½“
- `RechargeDO.java` - å……å€¼å®ä½“

## âš¡ æ€§èƒ½ä¼˜åŒ–è®°å½•
- é’±åŒ…ä½™é¢ä½¿ç”¨ä¹è§‚é”é˜²æ­¢å¹¶å‘é—®é¢˜
- äº¤æ˜“æµæ°´ä½¿ç”¨å¼‚æ­¥å†™å…¥ï¼ˆKafkaå‘é€åå¼‚æ­¥å¤„ç†ï¼‰
- é’±åŒ…ä½™é¢ç¼“å­˜åˆ°Redisï¼ˆç”¨æˆ·æŸ¥è¯¢æ—¶å…ˆæŸ¥ç¼“å­˜ï¼‰
- å¯¹è´¦ä»»åŠ¡å®šæ—¶æ‰§è¡Œï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹ï¼‰

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¼€å‘è§„èŒƒ
1. **æ‰€æœ‰é’±åŒ…æ“ä½œå¿…é¡»è®°å½•äº¤æ˜“æµæ°´**
2. **é’±åŒ…ä½™é¢ä¿®æ”¹å¿…é¡»ä½¿ç”¨ä¹è§‚é”ï¼ˆé˜²æ­¢è¶…å–ï¼‰**
3. **æç°ç”³è¯·å¿…é¡»ç»è¿‡å®¡æ ¸æµç¨‹**
4. **æ‰€æœ‰æ•æ„Ÿæ“ä½œå¿…é¡»è®°å½•å®¡è®¡æ—¥å¿—**

### å¸¸è§å‘ç‚¹
1. é’±åŒ…å¹¶å‘é—®é¢˜ï¼ˆä½¿ç”¨ä¹è§‚é”æˆ–åˆ†å¸ƒå¼é”ï¼‰
2. äº¤æ˜“æµæ°´çš„æ”¶æ”¯å¹³è¡¡ï¼ˆå®šæœŸå¯¹è´¦ï¼‰
3. æç°é‡‘é¢å¿…é¡»å¤§äºæœ€å°æç°é¢åº¦ï¼ˆå¦‚5å…ƒï¼‰
4. æç°å®¡æ ¸æµç¨‹çš„æ—¶é—´é™åˆ¶

### å¹¶å‘æ§åˆ¶ç­–ç•¥
```
ä½¿ç”¨ä¹è§‚é”ï¼š
UPDATE wallet SET balance = balance + ?, version = version + 1
WHERE user_id = ? AND version = ?

å¦‚æœUPDATEè¿”å›0è¡Œï¼Œåˆ™è¯´æ˜ä½™é¢ä¸è¶³æˆ–å…¶ä»–çº¿ç¨‹å·²ä¿®æ”¹ï¼Œéœ€è¦é‡è¯•
```

## ğŸ“Š æ•°æ®åº“è¡¨è®¾è®¡

### æ ¸å¿ƒè¡¨
1. **wallet**ï¼ˆé’±åŒ…è¡¨ï¼‰
   - ä¸»é”®ï¼šid
   - å­—æ®µï¼šuser_id, balance, frozen_balance, versionï¼ˆä¹è§‚é”ï¼‰, create_time, update_time
   - å”¯ä¸€ç´¢å¼•ï¼šuk_user_id
   - ç´¢å¼•ï¼šidx_create_time

2. **transaction_record**ï¼ˆäº¤æ˜“æµæ°´è¡¨ï¼‰
   - ä¸»é”®ï¼šid
   - å­—æ®µï¼šuser_id, typeï¼ˆ1æ”¶å…¥/2æ”¯å‡ºï¼‰, amount, description, create_time
   - ç´¢å¼•ï¼šidx_user_id, idx_type, idx_create_time
   - åˆ†åŒºï¼šæŒ‰æœˆåˆ†åŒºï¼ˆä¿ç•™10å¹´ï¼‰

3. **reward_record**ï¼ˆæ‰“èµè®°å½•è¡¨ï¼‰
   - ä¸»é”®ï¼šid
   - å­—æ®µï¼špayer_id, payee_id, post_id, amount, message, create_time
   - ç´¢å¼•ï¼šidx_payer_id, idx_payee_id, idx_post_id

4. **withdraw_request**ï¼ˆæç°ç”³è¯·è¡¨ï¼‰
   - ä¸»é”®ï¼šid
   - å­—æ®µï¼šuser_id, amount, statusï¼ˆ0/1/2/3ï¼‰, bank_account, bank_name, account_name, create_time, update_time
   - ç´¢å¼•ï¼šidx_user_id, idx_status, idx_create_time

5. **withdraw_audit**ï¼ˆå®¡æ ¸è®°å½•è¡¨ï¼‰
   - ä¸»é”®ï¼šid
   - å­—æ®µï¼šrequest_id, auditor_id, audit_result, reason, audit_time
   - ç´¢å¼•ï¼šidx_request_id, idx_auditor_id

6. **recharge_order**ï¼ˆå……å€¼è®¢å•è¡¨ï¼‰
   - ä¸»é”®ï¼šid
   - å­—æ®µï¼šuser_id, package_id, amount, coins, status, payment_method, create_time, pay_time
   - ç´¢å¼•ï¼šidx_user_id, idx_status, idx_create_time

## ğŸ”„ æ›´æ–°è®°å½•
- 2025-10-16ï¼šåˆå§‹åˆ›å»ºMODULE_MEMORY
- 2025-10-16ï¼š**ğŸ”´ P0ä¿®æ­£** - æ‰“èµåŠŸèƒ½æ·»åŠ å¹³å°åˆ†æˆè§„åˆ™ï¼ˆ10.5%/20.6%ï¼‰
- 2025-10-16ï¼š**âœ… è¡¥å……** - å……å€¼åŠŸèƒ½æ·»åŠ å¤šæ¸ é“æ”¯ä»˜å’Œé€€æ¬¾æœºåˆ¶
- å¾…å¼€å‘ï¼šæ‰“èµã€å……å€¼ã€æç°ã€å®¡æ ¸åŠŸèƒ½
